{% extends "PublicBundle:Public:index.html.twig" %}

{% block header %}
        <header id="header" class="alt">
        <div id="div_logo">
            <h1 id="logo">
                <a href="{{path("Privee_accueil")}}">
                    <img src="{{ asset('bundles/public/assets/css/images/logo.jpg')}}" title="Accueil" alt="logo" height="60" width="60"/>
                </a>
            </h1>
        </div>          
            <!-- Menu -->
            {% block menu %}
                <nav>
                    <a href="{{path("Privee_accueil")}}">Accueil</a>
                    <a href="{{path("Privee_calendrier")}}">Calendrier</a>
                    <a href="{{path("fos_user_profile_edit")}}">Paramètres</a>
                    <a href="{{path("fos_user_security_logout")}}"  id="deconnexionBouton">Deconnexion</a>                    
                </nav>  
            {% endblock %}        
        </header>        
{% endblock %}


{% block contenu %}       
    <div id="mesInfosCompte">
        <table>
            <th>Mes réservations</th>
            {% set iter=1 %} 
            {% for resa in user.reservations %}
                {% if resa.dateReservation > date() and resa.etatReservation=="Valider"%}                                                      
                <tr class="idResa">
                    <td>{{iter}}</td>
                    <td>{{ fortmatDate(resa.dateReservation)}} 
                        <a class="annuleResa" id="{{resa.id}}"><img src="{{ asset('bundles/public/assets/css/images/cancel.jpg')}}" alt="Annuler" title="Annuler" height="20" width="20"/></a></td>
                </tr>
                    {% set iter=iter + 1 %}                                                        
                {% endif %}
            {% endfor %}
            {% if iter==1 %}
                <tr><td>Vous n'avez pas de réservations en cours</td></tr>
            {% endif %}
            <th>Mes informations</th>
            <tr><td>Solde</td><td>{{ user.money}} €</td></tr>
            <tr><td>Jeton (s)</td><td>{{ user.solde}}</td></tr>
            <tr><td>Identité</td><td>{{ user.prenom}} {{ user.nom }}</td></tr>
            <tr><td>Email</td><td>{{ user.email }}</td></tr>
            <tr><td>Téléphone</td><td>0{{ formatPhone(user.telephone) }}</td></tr>

        </table>      
    </div>
            
    <script>
        $(".annuleResa").click(function(){
            idResa=$(this).attr('id');
            annuler(idResa);
        });
        
        function annuler(idResa){            
            $.ajax({
                type:"POST",
                url:"{{ (path('Privee_annuler'))}}",
                data:{idResa:idResa},
                success: function (data) {                    
                }
            });
        }
        
        $(document).ajaxStop(function(){
            window.location.reload();
        });
    </script>

{% endblock contenu %}