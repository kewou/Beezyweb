{% extends "PublicBundle:Public:index.html.twig" %}

{% block header %}
        <header id="header" class="alt">
            <h1 id="logo"><a href="{{path("Privee_accueil")}}">Accueil</a></h1>            
            <!-- Menu -->
            {% block menu %}
                <nav id="nav">
                    <ul>
                        <li><a href="{{path("fos_user_profile_show")}}">{{user.nom}} {{user.prenom}}</a></li>
                        <li><a href="{{path("Privee_calendrier")}}">Calendrier</a></li>
                        <li><a href="{{path("fos_user_profile_edit")}}">Paramètres</a></li>
                        <li><a href="{{path("fos_user_security_logout")}}" class="button special">Deconnexion</a></li>
                    </ul>
                </nav>  
            {% endblock %}        
        </header>        
{% endblock %}

{% block contenu %}
    <input type='button' id='reserveDate' value='Réserver'>
    <input type='button' id='annuleDate' value='Annuler'>
    <div id="calendrier">        
        {{ cal.display() }}        
    </div>
    <div id='paginationCalendrier'>
        <ul>
            <li>
                <button class='nextSevenDay'>Suivant</button>                    
            </li>
            <li>
                <button class='previousSevenDay'>Précédent</button>                    
            </li>  
        </ul>
    </div>
    
    <script>
                            $("#annuleDate").css('display','none');
                    $("#reserveDate").css('display','none');
            $(document).on('change',"input[type='checkbox']",function(){
                 
                cocheCase();
                    if(this.checked) {
                        cocher=true;
                        if(this.className==='libre'){
                            $("#reserveDate").css('display','block');
                            $("#annuleDate").css('display','none');
                        }else{
                            $("#annuleDate").css('display','block');
                            $("#reserveDate").css('display','none');
                        }
                    }else{
                        if(this.className==='libre'){
                            $("#reserveDate").css('display','block');
                            $("#annuleDate").css('display','none');
                        }else{
                            $("#annuleDate").css('display','block');
                            $("#reserveDate").css('display','none');
                        }
                    }
                    
              });
             
             
            function cocheCase(){
            var cocher=false;

               
 
               
               
        }
    </script>
    




    
    
    <script>
        var date = new Date();
        $(document).ready(function(){            
            $('button.nextSevenDay').click(function(){
                date.setDate(date.getDate() + 7);
                var dateEnvoyer = date.format("yyyy-MM-dd h:mm:ss");
                $.post("{{ (path('Privee_calendrierPagination'))}}",{datePivot:dateEnvoyer},
                        function(data){                            
                            $('#calendrier').html(data);
                });                
            });
            $('button.previousSevenDay').click(function(){
                date.setDate(date.getDate() -7);
                var dateEnvoyer = date.format("yyyy-MM-dd h:mm:ss");
                $.post("{{ (path('Privee_calendrierPagination'))}}",{datePivot:dateEnvoyer},
                        function(data){
                            $('#calendrier').html(data);
                });                
            });            
                   
            


            $("#reserveDate").click(function(){
                reserver();
            });
            $("#annuleDate").click(function(){
                annuler();
            });            
            

            function reserver(){
                var tabResa = [];
                var tabControle=[]; 
                $("input[type='checkbox']:checked").each(function(){
                    tabResa.push($(this).val());
                });
                
                // Ajouter les controle Front
                controleReservation(tabResa,tabControle);
                if(tabControle.length !==0){
                    alert(tabControle[0]);
                }else{                
                    $.ajax({
                        type:"POST",
                        url:"{{ (path('Privee_reserver_controle'))}}",
                        data:{lesResaChoisi:tabResa},                    
                        async:false,
                        complete: function(data){                        
                                    if(data["responseText"]!==""){
                                        alert(data["responseText"]);
                                    }else{
                                        $.post("{{ (path('Privee_reserver'))}}",{lesResaChoisi:tabResa},
                                            function(data){
                                                $('#calendrier').html(data);
                                        });

                                    }
                       }
                    });
                }
                checkCase();
                var tabResa = [];
                var tabControle= [];
            }
            
            function annuler(){
                var tabResa = [];
                var tabControle=[]; 
                $("input[type='checkbox']:checked").each(function(){
                    tabResa.push($(this).val());
                });
                
                // Ajouter les controle Front
                //controleReservation(tabResa,tabControle);
                /*
                if(tabControle.length !==0){
                    alert(tabControle[0]);
                }else{               
                    $.ajax({
                        type:"POST",
                        url:"{{ (path('Privee_reserver_controle'))}}",
                        data:{lesResaChoisi:tabResa},                    
                        async:false,
                        complete: function(data){                        
                                    if(data["responseText"]!==""){
                                        alert(data["responseText"]);
                                    }else{
                                        $.post("{{ (path('Privee_annuler'))}}",{lesResaChoisi:tabResa},
                                            function(data){
                                                $('#calendrier').html(data);
                                        });

                                    }
                       }
                    });
                }*/
                
                $.post("{{ (path('Privee_annuler'))}}",{lesResaChoisi:tabResa},
                    function(data){
                        $('#calendrier').html(data);
                });

                var tabResa = [];
                var tabControle= [];
            }            
            
            function controleReservation(tabResa,tabControle){                
                if(tabResa.length > 2){
                    tabControle.push("Pas plus de deux resa");
                }            
            }
            
        });      
        
        Date.prototype.format = function (format){ //author: meizz
            var o = {
                "M+": this.getMonth() + 1, //month
                "d+": this.getDate(), //day
                "h+": this.getHours(), //hour
                "m+": this.getMinutes(), //minute
                "s+": this.getSeconds(), //second
                "q+": Math.floor((this.getMonth() + 3) / 3), //quarter
                "S": this.getMilliseconds() //millisecond
            }
            if (/(y+)/.test(format))
                format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(format))
                    format = format.replace(RegExp.$1,
                            RegExp.$1.length === 1 ? o[k] :
                            ("00" + o[k]).substr(("" + o[k]).length));
            return format;
            }            

                      
    </script>
{% endblock %}